---
checks for fct_invoices:
  # Check fails when invoice_id, quantity, total is missing or
  # when the data type of those columns is other than specified
  - schema:
      fail:
        when required column missing:
          [invoice_id, product_key, customer_key, invoice_date, quantity, total_sales]
        when wrong column type:
          invoice_id: string
          product_key: string
          customer_key: string
          invoice_date: date
          quantity: int
          total_sales: numeric
  # Check fails when NULL values in the column
  - missing_count(invoice_id) = 0:
      name: All invoices have a key
  # Check fails when the total of any invoices is negative
  - failed rows:
      name: All invoices have a positive total amount
      fail query: |
        SELECT invoice_id, total_sales
        FROM fct_invoices
        WHERE total_sales < 0
